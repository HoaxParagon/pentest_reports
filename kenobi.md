Intro  
This is a mock pentest report on the room called 'kenobi' on Try Hack Me.  
I believe this room is labeled as 'medium'.  

Executive Summary  
During this 'black box' penetration test I found 6 vulnerabilities. The vulnerabilities range  
from medium to critical. The out of date software, proftpd, and its exploitation led to remote code  
execution and ultimately I gained full control over this server.  


Vulnerabilities Summary  
web facing SAMBA share - high  
out of date OpenSSH - med  
out of date Proftpd - critical  
out of date Apache - med  
out of date samba - med  
SMB message signing disabled - med  

Details  

A port scan revealed 11 open ports. I found an internet facing samba share as well as out of  
date softwares. The out of date softwares include proftpd, openSSH, SAMBA and Apache.  
![](/screenshots/kenobi/2022-10-19-15_08_28-proftpd-version-port21.png)  
![](/screenshots/kenobi/2022-10-19-15_10_25-port22-version.png)  
![](/screenshots/kenobi/2022-10-20-09_26_38-samba-out-of-date.png)  
![](/screenshots/kenobi/2022-10-19-15_11_03-port80-version.png)  

Remediation for out of date software is to implement an update plan and carry that out in your  
environment.  


SMB message signing is also disabled by default. This is insecure by default and you'll need  
to fix this issue to avoid possible man in the middle attacks where a threat actor will sit in  
the middle of two connections to intercept traffic (beyond security). Remediation is to  
enable SMB message signing.
![](/screenshots/kenobi/2022-10-20-09_19_30-smb-msg-signing-disabled.png)  

Listing the shares from the web-facing SAMBA share shows an 'anonymous' share that I can  
access without any credentials. When asked for a password I pressed enter.  
![](/screenshots/kenobi/2022-10-20-09_38_55-smbclient-shares.png)  

Accessing the 'anonymous' share gives me access to a file called 'log.txt'. I downloaded the  
file using the 'get' command and exit the share.  
![](/screenshots/kenobi/2022-10-20-09_43_39-connect-and-list.png)  
![](/screenshots/kenobi/2022-10-20-09_42_54-ls-get-file.png)  

The contents of log.txt appears to be the configuration details regarding proftpd.  
![](/screenshots/kenobi/2022-10-20-09_48_11-proftpd-config-logtxt.png)  
At the bottom of the file includes a line about guest interaction and it's currently set to  
'yes'. Eliminating this option would disallow anonymous access and leave the share more  
secure.  
![](/screenshots/kenobi/2022-10-20-09_53_17-guest-enabled.png)

In my research I found an exploit for proftpd located at  
https://www.exploit-db.com/exploits/49908. Version 1.3.5 of proftpd is vulnerable to  
CVE-2015-3306. This exploit uses CPFR and CPTO (copy to and copy from) to read and write files.  
I found evidence of an SSH key being generated in the log.txt file at the very top. I'm going  
to get the SSH key from the user account using SITE CPFR and then use that to connect via SSH  
to gain a shell on the victim environment.  
![](/screenshots/kenobi/2022-10-20-10_06_34-ssh-key-gen-log.png)


The first step to getting this SSH id_rsa file is connecting to proftpd using netcat.
![](/screenshots/kenobi/2022-10-20-10_11_20-nc-connect-port21.png)

Now that I'm connected I can copy the id_rsa file to a location where I will have read/write  
permissions; typically this is the /tmp directory.
![](/screenshots/kenobi/2022-10-20-10_34_47-cp-id-rsa.png)

Now that the id_rsa file is copied to /var/tmp I'm going to mount that drive on my attack box.  
The steps are shown in screenshots below. First we create a directory to house the files. Then  
we mount the /var/tmp directory to it, then we copy the id_rsa file out of the mounted directory  
to the root of the attacking machine.  
![](/screenshots/kenobi/)
![](/screenshots/kenobi/)
![](/screenshots/kenobi/)
![](/screenshots/kenobi/)
![](/screenshots/kenobi/)
![](/screenshots/kenobi/)
![](/screenshots/kenobi/)
![](/screenshots/kenobi/)







References
https://www.beyondsecurity.com/scan-pentest-network-vulnerabilities-smb-signing-disabled
https://www.exploit-db.com/exploits/49908









