Intro  
This is a mock pentest report on the TryHackMe room 'anonymous'. The  
room is rated as 'medium'.  


Executive Summary  
During this 'black box' penetration test, I discovered 6 vulnerabilities. Most of the  
remediation for these vulnerabilities revolves around updating your software. The other thing  
that allowed me critical access was a writeable directory with a scheduled script inside.  
The remediation for that is to remove the script from the FTP server and limit access.  



Vulnerabilities Summary:  
web facing SMB - high  
anonymous login FTP - high  
anonymously writeable FTP script - critical  
openSSH out of date - high  
SAMBA out of date -- med  
vsftpd out of date -- med  

Details  

A port scan revealed 4 open ports.
445 and 139 are running SMB. Port 21 has a FTP server with  
anonymous login enabled. Port 22 is running an outdated version  
of openSSH, this is ranked as a high. Port 445 is running an outdated  
version of Samba smbd.  
![](/screenshots/anonymous/2022-10-20-14_12_43-samba-version.png)
![](/screenshots/anonymous/2022-10-20-11_01_37-list-smb-shares.png)  
![](/screenshots/anonymous/2022-10-20-12_30_06-port-22-full-info-outofdate.png)  
![](/screenshots/anonymous/2022-10-20-12_28_27-port-21-ftp-version.png)  


I logged into the FTP service with username 'anonymous' and pressed  
enter when it asked me for a password. There is one folder named scripts in this directory so  
cd'd into it and used the 'get' command to retrieve the files.  
![](/screenshots/anonymous/2022-10-20-11_16_21-anonymous-ftp-login.png)  
![](/screenshots/anonymous/2022-10-20-11_03_01-smb-pics-connect-and-get.png)  
![](/screenshots/anonymous/)  
![](/screenshots/anonymous/)  

Removed_files.log and to_do.txt have nothing of value in them. The clean.sh script  
executes every few minutes as if it's a chronjob.  
![](/screenshots/anonymous/)  
![](/screenshots/anonymous/)  
![](/screenshots/anonymous/)  

 I'm going to copy some shell code into that file and see if I can get access. This works  
 because I have write access as an anonymous user. This is a major vulnerability and  
 should be remediated as soon as possible. The script runs as a chronjob so I'll be able to  
 get the access afforded to me by that user.  

 ![](/screenshots/anonymous/2022-10-20-12_03_45-nano-clean-sh-updated-values.png)  

FTP back into the machine and 'PUT clean.sh clean.sh' to replace the file on the server.
![](/screenshots/anonymous/2022-10-20-13_38_51-put-clean-sh-clean-sh.png)  



 Now that the script has been changed it's time to start the listener on port 4444. Your IP  
 will be different, keep that in mind.  
 ![](/screenshots/anonymous/2022-10-20-12_08_11-started-listener.png)  
 ![](/screenshots/anonymous/)  
 ![](/screenshots/anonymous/)  
 

When the chronjob executes I receive a shell as user namelessone.   
 ![](/screenshots/anonymous/)  
 ![](/screenshots/anonymous/2022-10-20-12_09_10-started-listener-got-shell-as-namelessone.png)  


On my attack machine I download and save linpeas to a folder I created called 'share' then  
use python module http.server to serve the file on port 8000. On the test machine I download  
the linpeas.sh file with wget and then chmod the file to add executable permissions.  
 ![](/screenshots/anonymous/2022-10-20-12_25_24-saved-linpeas-serving-linpeas.png)  
![](/screenshots/anonymous/2022-10-20-12_26_04-linpeas-in-share-folder.png)  
![](/screenshots/anonymous/2022-10-20-12_35_38-wget-linpeas-on-victim-machine.png)  
![](/screenshots/anonymous/2022-10-20-12_37_39-chmod-linpeas.png)  

I executed linpeas.sh and found an SUID binary called 'env' that I can use to escalate my   privileges.  
The script also found the location of the file 'env', /usr/bin/env.  

![](/screenshots/anonymous/)  
![](/screenshots/anonymous/2022-10-20-12_38_48-execute-linpeas.png)  
![](/screenshots/anonymous/2022-10-20-12_48_04-env-privesc-vector.png)  

Using the site GTFObins located at https://gtfobins.github.io/ I can search for 'env'. The  
website gives me a command to execute and I receive a root shell. cd'ing back to /root and  
listing the files with ls leads me to the root.txt flag as shown.  

![](/screenshots/anonymous/2022-10-20-12_58_07-gtfobins-SUID-commands.png)  
![](/screenshots/anonymous/2022-10-20-13_13_29-env-root-shell-whoami.png)  
![](/screenshots/anonymous/2022-10-20-13_14_04-root-flag.png)  




References

https://gtfobins.github.io/














