INTRO  
This is my mock pentest report on a box hosted on TryHackMe. The box  
is called 'Daily Bugle' and is rated as 'Hard'.  


Executive Summary  
This report presents the results of a test of Daily Bugle's 'black box'  
penetration test. The findings detail 7 vulnerabilities ranging from medium  
to critical. Most of the vulnerabilities lie in out of date software and updating is  
recommended. Credentials were gain from a SQL injection vulnerability that needs to be  
patched as well. Detailed throughout the report is means by which I ultimately gained  
root access though a chain of vulnerable softwares.  

Vulnerabilities summary:  
out of date PHP - med  
out of date joomla web server - critical  
out of date openSSH - med  
SQL injection - high  
passwordless execute permission - critical  
creds stored in script - critical  
CVE-2021-4034 local privesc - high

Details  

A scan of the external services reveals 3 open ports.  

Port 80 is running Apache version 2.4.6 and PHP 5.6.40. Apache is currently  
up to date but PHP is far out of date as the current version of PHP is 8.1 (php).  


![](/screenshots/daily-bugle/2022-10-18-11_58_47-port-80-version-info.png)  


Port 22 shows usage of openSSH version 7.4. which is out of date. The current  
version of openSSH is 9.1. It's recommended that you update OpenSSH.  

![](/screenshots/daily-bugle/2022-10-18-12_01_26-port-22-ssh.png)  
   
Port 3306 is running a MariaDB server but no version information.  

![](/screenshots/daily-bugle/2022-10-18-11_59_55-port-3306-maria-db.png)  


Gobuster returned several directories and files to investigate. What's noteworthy  
here is '/administrator' and 'README.txt'. README.txt shows that the Joomla in use is  
version 3.7. The latest version of Joomla is 4.2.1. It's recommended that you update   
Joomla.  

![](/screenshots/daily-bugle/2022-10-18-14_49_01-gobuster-3.png)  


In my research I found a github page that offered a python script to exploit   
the SQL injection vulnerability, CVE-2017-8917, present in Joomla 3.7 (github).  

![](/screenshots/daily-bugle/2022-10-18-16_13_57-github-url.png)  
![](/screenshots/daily-bugle/2022-10-18-15_33_43-github-info.png)  

I used wget to retrieve the exploit script.  
![](/screenshots/daily-bugle/2022-10-18-16_07_36-wget-exploit.png)  

I invoked the exploit script, joomblah.py, with the URL under test.
The script returns usernames and a hash.  
![](/screenshots/daily-bugle/2022-10-18-16_16_26-invoke-joomblah.png)  
The output of the joomblah script is shown below.  
![](/screenshots/daily-bugle/2022-10-18-16_20_29-joomblah-output.png)  


I echo'd the hash given into a file named hash.txt and used john to crack the hash. The  
wordlist I used was 'rockyou.txt'. The password it cracked is 'spiderman123'.  
![](/screenshots/daily-bugle/2022-10-19-08_27_43-echo-hash-to-file.png)  
![](/screenshots/daily-bugle/2022-10-19-09_02_30-john-results.png)  


I tried logging into SSH with jonah and spiderman123 for the username/password but  
was unable to login with these credentials.  

The credentials I obtained are valid for the login page hosted at /administrator and  
I logged in to the control panel. The web facing login page is a vulnerability because  
anyone could attempt to bruteforce your credentials. It's recommended you limit the  
login page to be locally accessible only.  
![](/screenshots/daily-bugle/2022-10-18-15_47_49-login-url.png)  
![](/screenshots/daily-bugle/2022-10-18-15_47_24-web-facing-login.png)  

Research led me to a blog post about gaining a reverse shell by editing the templates  
PHP code to replace the previous code with PHP reverse shell code. First, I wget some 
PHP shell code from 'pentestmonkey's github page. The following screen  
shots show the process of changing the PHP. First, the previous code is selected and deleted, then  
the PHP shell code from pentestmonkey's github page is copied over and then parameters  
are set to reflect the IP address of the computer you're using. Your IP will be  
different than mine. Make sure that you save the template once the shell code is pasted  
 in.  
![](/screenshots/daily-bugle/2022-10-18-18_32_40-wget-php-shellcode.png)  
![](/screenshots/daily-bugle/2022-10-18-18_31_12-control_panel_templates.png)  
![](/screenshots/daily-bugle/2022-10-18-18_34_51-editing-template.png)  
![](/screenshots/daily-bugle/2022-10-18-18_35_34-editing-template-2.png)  
![](/screenshots/daily-bugle/2022-10-18-18_36_06-deleted-php.png)  
![](/screenshots/daily-bugle/2022-10-19-11_40_43-php-shell-pasted.png)  
![](/screenshots/daily-bugle/2022-10-18-18_37_22-setting-shell-params.png)  
![](/screenshots/daily-bugle/2022-10-18-18_48_00-saving-file.png)  

 Once the code is setup I started a listener with netcat on the port I selected,  
 4444, and activated the shell code by visting the site with that template.  
![](/screenshots/daily-bugle/2022-10-19-09_35_01-activating-shell.png)  
![](/screenshots/daily-bugle/2022-10-18-18_49_11-netcat-session-created.png)  

I found that python was installed so I used it to gain a bash shell.  
![](/screenshots/daily-bugle/2022-10-18-18_51_48-shell-upgrade-tty.png)  
![](/screenshots/daily-bugle/2022-10-18-18_52_28-whoami.png)  

The command sudo -l requires a sudo password for user apache. By running that command  
I'm trying to find out what passwordless sudo commands I can run. This is a typical  
method by which to privilege escalate. It's good that you don't allow for passwordless  
sudo commands to be run. This is one of the easiest methods of privilege escalation.  
There's no option to carry forward with this as user apache.  

The next step is to check for SUID/SGID binaries that will allow me to run as other  
users. If I can run a binary as root, I can gain an elevated shell pretty easily.  
As the screenshot shows, these commands resulted in no SUID/SGID binaries being found.  
![](/screenshots/daily-bugle/2022-10-19-09_17_27-no-suid-sgid-bins.png)  

The next step will be to use a privilege escalation script to search the drive for  
interesting files and folders. I'm using an automated script to save time  
and to catch everything I may miss while manually enumerating. The first step is to  
download and host the file on my attack machine. The URL for the linpeas release page  
is https://github.com/carlospolop/PEASS-ng/releases/tag/20221016. I downloaded the top  
option named 'linpeas.sh' and saved it to my root directory folder on the attack machine. I'm  
 going to copy this file to a share folder named 'share' under my root directory on my attack  
 machine then share the file using a common python module. The module http.server is meant to  
host files on a specified port. Now that I have the file in the ./share folder I can cd  
to that directory and share the file for download on my victim machine. You should note  
that your IPs will be different than mine. I have used cd to change directories on the victim  
machine to the /tmp directory. That directory is universally writeable and is what we'll use 
to download linpeas.sh locally.  

save the file  
![](/screenshots/daily-bugle/2022-10-19-09_25_00-saving-linpeas.png)  
serve the file  
![](/screenshots/daily-bugle/2022-10-19-09_35_45-serving-file.png)  
wget on victim machine  
![](/screenshots/daily-bugle/2022-10-19-09_38_34-wget-linpeas.png)  


Now that the linpeas.sh script is saved to the victim machine, I can chmod it to make it  
executable and then run it. The output can be lengthy so I pipe it to tee which will save  
a file called linresults.txt  

![](/screenshots/daily-bugle/2022-10-19-09_41_32-chmod-linpeas.png)  
![](/screenshots/daily-bugle/2022-10-19-09_57_56-linpeas-run.png)  

Linpeas found that the OS is vulnerable to CVE-2021-4034. This is a local privilege escalation  
vulnerability I chose not to exploit during this test.  
![](/screenshots/daily-bugle/2022-10-19-10_02_37-cve-1.png)  

The script found a password in a PHP config file. The username 'jjameson' and password  
'nv5uz9r3ZEDzVjNu' are valid credentials with which to laterally move. Now logged into  
the user jjameson's account I can cd back to his home directory and there we find the  
flag 'user.txt'.  

![](/screenshots/daily-bugle/2022-10-19-10_03_47-possible-password.png)  
![](/screenshots/daily-bugle/2022-10-19-10_05_51-user-found-jjameson.png)  
![](/screenshots/daily-bugle/2022-10-19-10_08_46-whoami-jjameson.png)  
![](/screenshots/daily-bugle/2022-10-19-10_10_00-user-flag.png)  

When I execute sudo -l on this account I can see that we have access to YUM. I navigated  
to https://gtfobins.github.io/ and search for YUM. This site is one that tells me how  
to use binaries to break out and escalate my privileges. By copy/pasting the commands  
shown in red, we can spawn a root shell. Starting at (b) and working through line by  
line, we'll copy and paste each line into our terminal that's logged in as jjameson. In  
the end we have a root shell after invoking sudo yum.  

![](/screenshots/daily-bugle/2022-10-19-10_11_47-sudo-YUM-1.png)  
![](/screenshots/daily-bugle/2022-10-19-10_14_42-GTFObins-yum.png)  


Once again python is used to invoke bash for a better shell. I changed directories back to  
 /root and found the root.txt flag.  
![](/screenshots/daily-bugle/2022-10-19-12_42_47-proof-of-root.png)  
![](/screenshots/daily-bugle/2022-10-19-10_28_00-cd-root-and-ls.png)  
![](/screenshots/daily-bugle/2022-10-19-10_28_33-cat-root-txt.png)  


References

www.php.net/releases/index.php  
https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html  
https://github.com/stefanlucas/Exploit-Joomla  
https://www.hackingarticles.in/joomla-reverse-shell/  
https://github.com/pentestmonkey/php-reverse-shell  
https://github.com/carlospolop/PEASS-ng/releases/tag/20221016  
https://gtfobins.github.io/  



